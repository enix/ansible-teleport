---
- name: "Checking system OS"
  ansible.builtin.assert:
    that: ansible_os_family | lower is in ['debian', 'vyos']
    fail_msg: "{{ ansible_os_family }} is not supported by the role unless binary compat mode is used."
  when: not (teleport__binary_compat)

- name: "Detecting if we should use legacy APT signing"
  set_fact:
    teleport__apt_signing_legacy: true
  when: (ansible_distribution == "Debian" and ansible_distribution_version is version("9", "<")) or
        (ansible_distribution == "Ubuntu" and ansible_distribution_version is version("20.04", '<'))

- include_tasks: install-packages.yml
  when: teleport__install_repo

- include_tasks: install-binary-compat.yml
  when: teleport__binary_compat

- include_tasks: configure.yml
  when: teleport__agent
  tags: config
